
function doPost(e) {
  var lock = LockService.getScriptLock();
  lock.waitLock(30000); // Wait a maximum of 30 seconds to prevent errors from multiple simultaneous submissions.

  try {
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("DeckRequests");
    if (!sheet) {
      throw new Error("Sheet 'DeckRequests' was not found. Please check the name.");
    }

    var headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
    var newRow = [];

    for (var i = 0; i < headers.length; i++) {
      var header = headers[i];
      var value = "";

      if (header.toLowerCase() === "timestamp") {
        value = new Date();
      } else {
        // This correctly handles both single form fields and multiple-choice checkboxes
        if (e.parameters[header] && e.parameters[header].length > 1) {
          value = e.parameters[header].join(', ');
        } else {
          value = e.parameter[header] || "";
        }
      }
      newRow.push(value);
    }
    
    sheet.appendRow(newRow);
    
    // Return a proper JSON success response that the website can understand.
    return ContentService
      .createTextOutput(JSON.stringify({ "result": "success" }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    // Return a detailed error if something goes wrong.
    return ContentService
      .createTextOutput(JSON.stringify({ "result": "error", "error": error.toString() }))
      .setMimeType(ContentService.MimeType.JSON);
  } finally {
    lock.releaseLock();
  }
}





https://script.google.com/macros/s/AKfycbzcmND809zEePZzvOLxxM1GolqWM1Lrh11JV9tdprNxSgkp-u0sjlxRzqXtmjDQDtn_2Q/exec




